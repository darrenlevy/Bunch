var gameLogic;!function(a){function b(){return[c(),c(),c()]}function c(){for(var b=[],c=[],h=0;h<a.DECK_SIZE;h++){var i=[],j="";do i=[d(),e(),f(),g()],j=i[0]+i[1]+i[2]+i[3];while(-1!==c.indexOf(j));c[h]=j,b[h]=i}return b}function d(){var b=["♡","✰","☺"],c=Math.floor(100*Math.random()%a.NUMBER_OF_TYPES);return b[c]}function e(){var b=Math.floor(100*Math.random()%a.NUMBER_OF_TYPES)+1;return String(b)}function f(){var b=["pink","orange","green"],c=Math.floor(100*Math.random()%a.NUMBER_OF_TYPES);return b[c]}function g(){var b=["solid","dotted","double"],c=Math.floor(100*Math.random()%a.NUMBER_OF_TYPES);return b[c]}function h(){return{decks:b(),bunches:[],round:1,scores:[0,0]}}function i(b){return b>a.TOTAL_ROUNDS}function j(a){return a[0]==a[1]?[0,0]:a[0]>a[1]?[1,0]:[0,1]}function k(b,c){var d=30-c>0?30-c:0;if(0===b.length)return 30-c>10?10:30-c>0?30-c:0;if(b.length!==a.NUMBER_OF_TYPES)return-1;for(var e=0;e<a.NUMBER_OF_ELEMENTS_PER_CARD;e++){for(var f=[],g=0;g<b.length;g++){var h=b[g][e];-1==f.indexOf(h)&&f.push(h)}if(d+=3*f.length,1!==f.length&&f.length!==a.NUMBER_OF_TYPES)return-1}return d}function l(b,c,d,e,f,g){if(i(f))throw new Error("Can only make a move if the game is not over!");b||(b=h());for(var l=b.decks[f-1],m=[],n=0;n<c.length;n++)m.push(l[c[n]]);var o=k(m,d);if(0>o)throw new Error("That is not a legal move!");var p=angular.copy(g);p[e]+=o;var q=angular.copy(b.bunches);q.push({cardIndices:c,seconds:d});var r,s=null,t=angular.copy(f);q.length%a.NUMBER_OF_PLAYERS===1?r=1-e:(r=e,t++),i(t)&&(s=j(p),r=-1);var u={decks:b.decks,bunches:q,round:t,scores:p};return{endMatchScores:s,turnIndexAfterMove:r,stateAfterMove:u}}function m(a){var b=a.turnIndexBeforeMove,c=a.stateBeforeMove;c||(c=angular.copy(a.move.stateAfterMove),c.bunches=[],c.round=1,c.scores=[0,0]);var d=a.move,e=a.move.stateAfterMove.bunches,f=e[e.length-1],g=f.cardIndices,h=f.seconds,i=c?c.round:1,j=c?c.scores:[0,0],k=l(c,g,h,b,i,j);if(!angular.equals(d,k))throw new Error("Move calculated="+angular.toJson(k,!0)+", move expected="+angular.toJson(d,!0))}a.DECK_SIZE=16,a.TOTAL_ROUNDS=2,a.NUMBER_OF_PLAYERS=2,a.NUMBER_OF_ELEMENTS_PER_CARD=4,a.NUMBER_OF_TYPES=3,a.getInitialState=h,a.pointsForMove=k,a.createMove=l,a.checkMoveOk=m}(gameLogic||(gameLogic={}));var game;!function(a){function b(){translate.setTranslations(c()),translate.setLanguage("en"),log.log("Translation of 'RULES_OF_BUNCHES' is "+translate("RULES_OF_BUNCHES")),resizeGameAreaService.setWidthToHeight(1.5),moveService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,checkMoveOk:gameLogic.checkMoveOk,updateUI:f}),document.addEventListener("animationend",d,!1),document.addEventListener("webkitAnimationEnd",d,!1),document.addEventListener("oanimationend",d,!1);var a=window;a.HTMLInspector&&setInterval(function(){a.HTMLInspector.inspect({excludeRules:["unused-classes","script-placement"]})},3e3)}function c(){return{RULES_OF_BUNCHES:{en:"Rules of Bunches",es:"Reglas de Los Manojos"},RULES_SLIDE1:{en:"You and your opponent take turns finding a Bunch. A Bunch is 3 cards where the number of emoji, color of emoji, the emoji itself and border of the card are all the same or all different.",es:"Usted y su oponente se da vuelta para encontrar un manojo. Un manojo es 3 cartas donde el número de emoji, el color de emoji, el propio emoji y el borde de la tarjeta son todos iguales o diferentes."},RULES_SLIDE2:{en:"There are 2 rounds. Player 1 starts the first round. Player 2 starts the second round. You receive 1 point for similarities and 3 points for differences.",es:"Hay 2 rondas. El jugador 1 comienza la primera ronda. El jugador 2 se inicia la segunda ronda. Recibe 1 punto por similitudes y 3 puntos por diferencias."},CLOSE:{en:"Close",es:"Cerca"}}}function d(){$rootScope.$apply(function(){log.info("Animation ended"),a.animationEnded=!0})}function e(){a.isComputerTurn&&(a.isComputerTurn=!1,moveService.makeMove(aiService.findComputerMove(a.move)))}function f(b){log.info("Game got updateUI:",b),a.animationEnded=!1,a.move=b.move,a.state=a.move.stateAfterMove,a.state||(a.state=gameLogic.getInitialState(),a.move.endMatchScores=[0,0],a.move.turnIndexAfterMove=0,a.move.stateAfterMove=a.state),l(a.state.scores),a.canMakeMove=a.move.turnIndexAfterMove>=0&&b.yourPlayerIndex===a.move.turnIndexAfterMove,a.deckIndex=a.canMakeMove?a.state.round-1:a.deckIndex,a.move.turnIndexAfterMove<0&&$interval.cancel(J),a.isComputerTurn=a.canMakeMove&&""===b.playersInfo[b.yourPlayerIndex].playerId,a.isComputerTurn&&(a.canMakeMove=!1,e())}function g(){return a.move.turnIndexAfterMove<0}function h(b){return g()?0==b?a.player1Score==a.player2Score:1==b?a.player1Score>a.player2Score:2==b?a.player1Score<a.player2Score:!1:!1}function i(b){if(a.state&&a.state.bunches.length%2==1){var c=a.state.bunches.length-1,d=a.state.bunches[c];if(d.seconds<=a.seconds&&-1!==d.cardIndices.indexOf(b))return}var e=a.cards.indexOf(b);-1==e?a.cards.push(b):a.cards.splice(e,1),a.cards.length>=3?(a.cardsPlayed=a.cards,n()):a.cardsPlayed=[]}function j(b){return a.move.turnIndexAfterMove==b}function k(){!g()&&a.canMakeMove&&(a.roundStarted=!0,a.cardsPlayed=[],J=$interval(function(){a.seconds++},1e3))}function l(b){$interval.cancel(J),a.roundStarted=!1,a.cards=[],a.seconds=0,a.player1Score=b[0],a.player2Score=b[1]}function m(){a.canMakeMove&&(a.cards=[],n())}function n(){if("?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.canMakeMove)try{var b=gameLogic.createMove(a.state,a.cards,a.seconds,a.move.turnIndexAfterMove,a.state.round,a.state.scores);a.canMakeMove=!1,moveService.makeMove(b)}catch(c){return log.info(["Invalid cards:",a.cards]),void(a.cards=[])}}function o(b){for(var c="",d=parseInt(a.state.decks[a.deckIndex][b][1]),e=0;d>e;e++)c+=a.state.decks[a.deckIndex][b][0]+" ";return c}function p(b){return"green"==a.state.decks[a.deckIndex][b][2]}function q(b){return"pink"==a.state.decks[a.deckIndex][b][2]}function r(b){return"orange"==a.state.decks[a.deckIndex][b][2]}function s(b){return"solid"==a.state.decks[a.deckIndex][b][3]}function t(b){return"dotted"==a.state.decks[a.deckIndex][b][3]}function u(b){return"double"==a.state.decks[a.deckIndex][b][3]}function v(b){if(a.state&&a.state.bunches.length%2==1){var c=a.state.bunches.length-1,d=a.state.bunches[c];if(d.seconds<=a.seconds&&-1!==d.cardIndices.indexOf(b))return-1!==a.cards.indexOf(b)&&a.cards.splice(a.cards.indexOf(b),1),!0}return!1}function w(b){if(a.state&&a.state.bunches.length%2==1){var c=a.state.bunches.length-1,d=a.state.bunches[c];return-1!==d.cardIndices.indexOf(b)}return!1}function x(b){if(g())return!1;if(a.seconds<20)return!1;for(var c=(a.state.decks[a.state.round-1],aiService.getPossibleMoves(a.state,a.move.turnIndexAfterMove)),d=!1,e=0;e<c.length;e++){for(var f=c[e],h=f.stateAfterMove.bunches,i=h[h.length-1],j=!1,k=0;k<i.cardIndices.length&&!(j=w(i.cardIndices[k]));k++);if(!j){if(d=!0,20==a.seconds)return i.cardIndices[0]==b;if(30==a.seconds)return i.cardIndices[1]==b}}return-1==b&&a.seconds>30&&!d}function y(b){if(-1!==a.cardsPlayed.indexOf(b)){for(var c=[],d=0;3>d;d++){var e=a.cardsPlayed[d],f=a.state.decks[a.state.round-1][e][3];-1===c.indexOf(f)&&c.push(f)}return 1!==c.length&&3!==c.length}return!1}function z(b){if(-1!==a.cardsPlayed.indexOf(b)){for(var c=[],d=[],e=[],f=0;3>f;f++){var g=a.cardsPlayed[f],h=a.state.decks[a.state.round-1][g][0],i=a.state.decks[a.state.round-1][g][1],j=a.state.decks[a.state.round-1][g][2];-1===c.indexOf(h)&&c.push(h),-1===d.indexOf(i)&&d.push(i),-1===e.indexOf(j)&&e.push(j)}return 1!==c.length&&3!==c.length||1!==d.length&&3!==d.length||1!==e.length&&3!==e.length}return!1}function A(b){a.resultRound==b&&(a.showResults=!a.showResults),a.resultRound=b}function B(b,c){var d=a.resultRound-1;if(d%2==1&&(b=1-b),a.state.bunches.length<=2*d+b)return!1;if(0==a.state.bunches[2*d+b].cardIndices.length)return!1;var e=a.state.bunches[2*d+b].cardIndices[c];return"green"==a.state.decks[d][e][2]}function C(b,c){var d=a.resultRound-1;if(d%2==1&&(b=1-b),a.state.bunches.length<=2*d+b)return!1;if(0==a.state.bunches[2*d+b].cardIndices.length)return!1;var e=a.state.bunches[2*d+b].cardIndices[c];return"pink"==a.state.decks[d][e][2]}function D(b,c){var d=a.resultRound-1;if(d%2==1&&(b=1-b),a.state.bunches.length<=2*d+b)return!1;if(0==a.state.bunches[2*d+b].cardIndices.length)return!1;var e=a.state.bunches[2*d+b].cardIndices[c];return"orange"==a.state.decks[d][e][2]}function E(b,c){var d=a.resultRound-1;if(d%2==1&&(b=1-b),a.state.bunches.length<=2*d+b)return!1;if(0==a.state.bunches[2*d+b].cardIndices.length)return!1;var e=a.state.bunches[2*d+b].cardIndices[c];return"solid"==a.state.decks[d][e][3]}function F(b,c){var d=a.resultRound-1;if(d%2==1&&(b=1-b),a.state.bunches.length<=2*d+b)return!1;if(0==a.state.bunches[2*d+b].cardIndices.length)return!1;var e=a.state.bunches[2*d+b].cardIndices[c];return"dotted"==a.state.decks[d][e][3]}function G(b,c){var d=a.resultRound-1;if(d%2==1&&(b=1-b),a.state.bunches.length<=2*d+b)return!1;if(0==a.state.bunches[2*d+b].cardIndices.length)return!1;var e=a.state.bunches[2*d+b].cardIndices[c];return"double"==a.state.decks[d][e][3]}function H(b,c){var d="",e=a.resultRound-1;if(e%2==1&&(b=1-b),a.state.bunches.length<=2*e+b)return"";if(0==a.state.bunches[2*e+b].cardIndices.length)return"";for(var f=a.state.bunches[2*e+b].cardIndices[c],g=parseInt(a.state.decks[e][f][1]),h=0;g>h;h++)d+=a.state.decks[e][f][0];return d}function I(b){return b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.isHelpModalShown=!1),!0}a.animationEnded=!1,a.canMakeMove=!1,a.isComputerTurn=!1,a.move=null,a.state=null,a.isHelpModalShown=!1,a.cards=[],a.cardsPlayed=[],a.seconds=0,a.player1Score=0,a.player2Score=0,a.deckIndex=0,a.resultRound=1,a.roundStarted=!1;var J;a.showResults=!1,a.init=b,a.gameIsOver=g,a.isWinner=h,a.cardClicked=i,a.isCurrentPlayerIndex=j,a.startClicked=k,a.passMove=m,a.submitMove=n,a.getEmoji=o,a.isGreen=p,a.isPink=q,a.isOrange=r,a.isSolid=s,a.isDotted=t,a.isDouble=u,a.shouldFlip=v,a.shouldHintCardIndex=x,a.shouldShakeCard=y,a.shouldBounceEmoji=z,a.resultRoundClicked=A,a.resultIsGreen=B,a.resultIsPink=C,a.resultIsOrange=D,a.resultIsSolid=E,a.resultIsDotted=F,a.resultIsDouble=G,a.getResultEmoji=H,a.clickedOnModal=I}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,game.init()});var aiService;!function(a){function b(a){return d(a,{millisecondsLimit:1e3})}function c(a,b){for(var c=30,d=[],e=0;e<gameLogic.DECK_SIZE;e++)for(var f=e+1;f<gameLogic.DECK_SIZE;f++)for(var g=f+1;g<gameLogic.DECK_SIZE;g++)try{if(a.bunches.length%2==1&&a.bunches[a.bunches.length-1].cardIndices.sort()==[e,f,g].sort())continue;var h=a.decks[a.round-1],i=h[e],j=h[f],k=h[g],l=gameLogic.pointsForMove([i,j,k],c);l>=0&&d.push(gameLogic.createMove(a,[e,f,g],c,b,a.round,a.scores))}catch(m){}return 0==d.length&&d.push(gameLogic.createMove(a,[],c,b,a.round,a.scores)),d}function d(a,b){var c=e(a,a.turnIndexAfterMove);return c[c.length-1]}function e(a,b){return c(a.stateAfterMove,b)}a.findComputerMove=b,a.getPossibleMoves=c,a.createComputerMove=d}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map